<!DOCTYPE html>
<meta charset="utf-8">
<head>
	<title> Responsive Chart </title>
	<style>
		body {
		  font: 14px sans-serif;
		  
		}

		.axis path,
		.axis line {
		  fill: none;
		  stroke: #000;
		  shape-rendering: geometricPrecision;
		}

		.x.axis path {
		  display: black;
		}

		.line {
		  fill: none;
		  stroke: steelblue;
		  stroke-width: 1.5px;
		}
	</style>
	
	<script src="http://d3js.org/d3.v3.js"></script>
	
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
	
	<script>
		var rect_data = [];
		var svg;
		function display_money (p_id) {
			var num = Number (p_id.match(/\d+/g));
			var rect_id = "rect" + num;
			var rect_pos_x;
			var rect_pos_y;
			var rect_status;
			var index;
			for ( index = 0; index < rect_data.length; index++) {
				if (p_id == rect_data[index].id) {
					rect_pos_x = rect_data[index].x - 50;
					rect_pos_y = rect_data[index].y - 30;
					rect_status = rect_data[index].s;
					break;
				}
			}
			if (rect_status == 0) {
				d3.select("#"+rect_id).remove();
				rect_data[index].s = 1;
			} else {
				rect_data[index].s = 0;
				var myrect = svg.append("rect")
					.attr("class","ro")
					.attr("height", 30)
					.attr("width",50)
					.attr("fill", "blue")
					.attr("x", rect_pos_x)
					.attr("y", rect_pos_y)
					.attr("id",rect_id);
			}
		}
		
		function load_chart () {
			var margin 			= {top: 120, right: 120, bottom: 80, left: 100};
			var width 			= document.documentElement.clientWidth - margin.left - margin.right;
			var height 			= document.documentElement.clientHeight - margin.top - margin.bottom;
			var no_of_ticks_x 	= width  / 100;
			var no_of_ticks_y 	= height / 50;
		
			var FundPerformance = [      
				{
				"FundValue": "00000000",
				"FundDate": "2015-01-21"
				},
				{
				"FundValue": "200000",
				"FundDate": "2015-01-22"
				},
				{
				"FundValue": "400000",
				"FundDate": "2015-01-23"
				},
				{
				"FundValue": "600000",
				"FundDate": "2015-01-24"
				},
				{
				"FundValue": "800000",
				"FundDate": "2015-01-25"
				}
			];
			var TotalInvestmentWithdrawals = [
			{
				"InvestmentDate": "2015-01-22 14:52:55",
				"InvestmentAmount": "100000.0000",
				"InvestmentType": "One Time"
			}
			];
			var TotalInvestmentDeposit = [
			{
				"InvestmentDate": "2015-01-21 14:37:38",
				"InvestmentAmount": "300000.0000",
				"InvestmentType": "One Time"
			},
			{
				"InvestmentDate": "2015-01-24 14:51:11",
				"InvestmentAmount": "21000.0000",
				"InvestmentType": "One Time"
			}
			];
			var x, y;
			var color;
			var xAxis, yAxis;
			var line;
			var MaximumFund;
			var MinimumFund;
			var transactions, transaction;
			var day;
			var FundOnDate;
			var rect_data_i = 0;
			var rect_pos_x;
			var rect_pos_y;
			var rect_id;
			
			$(document).ready(function(){
				x = d3.time.scale()
					.range([0, width]);
				
				y = d3.scale.linear()
					.range([height,0]);

				color = d3.scale.category10();
				
				xAxis = d3.svg.axis()
						.scale(x)
						.orient("bottom")
						.ticks(no_of_ticks_x);

				yAxis = d3.svg.axis()
						.scale(y)
						.orient("left")
						.ticks(no_of_ticks_y);

				line = 	d3.svg.line()
						.interpolate("linear")
						.x(function(d) { return x(d.FundDate); })
						.y(function(d) { return y(d.FundValue); });
					
				svg = 	d3.select("body").append("svg")
						.attr("width", width + margin.left + margin.right)
						.attr("height", height + margin.top + margin.bottom)
						.append("g")
						.attr("transform", "translate(" + margin.left + "," + margin.top + ")");
				
				MaximumFund = 0.0;
				MinimumFund = parseFloat(FundPerformance[0].FundValue);
				
				for ( var index = 0; index < FundPerformance.length; index++) {
					FundPerformance[index].FundDate = d3.time.format("%Y-%m-%d").parse(FundPerformance[index].FundDate);
					FundPerformance[index].FundValue = parseFloat(FundPerformance[index].FundValue);
					if (FundPerformance[index].FundValue > MaximumFund)
						MaximumFund = FundPerformance[index].FundValue;
					if (FundPerformance[index].FundValue < MinimumFund)
						MinimumFund = FundPerformance[index].FundValue;
				}
				color.domain(["FundValue","FundDate"]);
				transactions = color.domain().map(function(name) {
									return {
										name: name,
										values: FundPerformance.map(function(d) {
											return {FundDate: d.FundDate, FundValue: +d[name]};
										})
									};
								});
						
				x.domain(d3.extent(FundPerformance, function(d) { return d.FundDate; }));
				y.domain([MinimumFund - MaximumFund * .10, MaximumFund + MaximumFund * .10]);
						
				svg.append("g")
					.attr("class", "x axis")
					.attr("transform", "translate(0," + height + ")")
					.call(xAxis);

				svg.append("g")
					.attr("class", "y axis")
					.call(yAxis)
					.append("text")
					.attr("transform", "rotate(-90)")
					.attr("y", 6)
					.attr("dy", ".71em")
					.style("text-anchor", "end")
					.text("Investment");

				transaction = 	svg.selectAll(".transactions")
									.data(transactions)
									.enter().append("g")
									.attr("class", "transactions");
							
				transaction.append("path")
					.attr("class", "line")
					.attr("d", function(d){return line(d.values);})
					.style("stroke",function(d){return color(d.name);});
							
				transaction.append("text")
					.datum(function(d) { return {name: d.name, value: d.values[d.values.length - 1]}; })
					.attr("transform", function(d) { return "translate(" + x(d.value.FundDate) + "," + y(d.value.FundValue) + ")"; })
					.attr("x", ".3em")
					.attr("dy", ".35em")
					.text(function(d) { return d.name; });		
				
				for (var i = 0; i < TotalInvestmentWithdrawals.length; i++) {
					day = 0;
					for (var j = 0; j < FundPerformance.length; j++) {
						day++;
						var date = TotalInvestmentWithdrawals[i].InvestmentDate.split(' ');
						date = d3.time.format("%Y-%m-%d").parse(date[0]);
						if (date - FundPerformance[j].FundDate == 0) {
							FundOnDate = FundPerformance[j].FundValue;
							rect_pos_x = (day - 1) / (FundPerformance.length - 1) * width;
							rect_pos_y = height - (FundOnDate+MaximumFund*.10) / ((MaximumFund+MaximumFund*.10)-(MinimumFund-MaximumFund*.10)) * height;							
							rect_id = "r" + rect_data_i;
							rect_data[rect_data_i++] = { id:rect_id, x:rect_pos_x, y:rect_pos_y, s:1 };
	
							svg.append("rect")
								.attr("height", 20)
								.attr("width",20)
								.attr("fill", "red")
								.attr("id",rect_id)
								.attr("onclick","display_money(this.id)")
								.attr("x", rect_pos_x)
								.attr("y", rect_pos_y);
							break;
						}
					}
				}	
				
				for (var i = 0; i < TotalInvestmentDeposit.length; i++) 
				{
					day = 0;
					for (var j = 0; j < FundPerformance.length; j++) 
					{
						day++;
						var date = TotalInvestmentDeposit[i].InvestmentDate.split(' ');
						date = d3.time.format("%Y-%m-%d").parse(date[0]);
						if (date  - FundPerformance[j].FundDate == 0) 
						{
							FundOnDate = FundPerformance[j].FundValue;
							rect_pos_x = (day - 1) / (FundPerformance.length - 1) * width;
							rect_pos_y =  height - (FundOnDate+MaximumFund*.10) / ((MaximumFund+MaximumFund*.10)-(MinimumFund-MaximumFund*.10)) * height;
							rect_id = "r" + rect_data_i;
							rect_data[rect_data_i++] = { id:rect_id, x:rect_pos_x, y:rect_pos_y, s:1 };
	
							svg.append("rect")
								.attr("height", 20)
								.attr("width",20)
								.attr("fill", "green")
								.attr("id",rect_id)
								.attr("onclick","display_money(this.id)")
								.attr("x", rect_pos_x)
								.attr("y", rect_pos_y);
							break;
						}
					}
				}	
			});
		}
		
		// resize
		d3.select(window).on('resize', resize);
		
		function resize() {
			// Erase old chart
			d3.select("svg").remove();
			
			// Redraw chart			
			load_chart();
		}
	</script>

<body onload = "load_chart()">
</body>